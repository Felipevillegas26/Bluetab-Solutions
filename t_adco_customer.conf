


kirby {
    input {
        type=csv
        options {
            delimiter=";"
            mode = "FAILFAST"
            #castMode=notPermissive
        }
        paths = [
            "/in/staging/ratransmit/external/sybase/aggr/mov_agregacion_d"${?INSTANCE_DATE}".txt"
        ]
        schema {
            path = ${ARTIFACTORY_UNIQUE_CACHE}"/artifactory/"${SCHEMAS_REPOSITORY}"/schemas/ar/adco/raw/aggrmovement/latest/aggrmovement.input.schema"
        }
    }
    output {
    dropLeftoverFields = true
        #coalesce {
        #    partitions=0
        #}
        force=true
        mode = "append"
    reprocess = true
        options {}
        partition=[
            "process_date_period_id",
            "process_date"
        ]
        path="/data/raw/aggr/data/t_adco_aggr_movement"
        reprocessPartition = ["process_date_period_id="${?PERIOD_REP}/"process_date="${?INSTANCE_DATE}]
        schema {
            path=${ARTIFACTORY_UNIQUE_CACHE}"/artifactory/"${SCHEMAS_REPOSITORY}"/schemas/ar/adco/raw/aggrmovement/latest/aggrmovement.output.schema"
        }
        type=avro
    }
    transformations=[
        {
            field = "origin_transaction_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "g_movement_type"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_customer_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_ext_entity_account_id"
            type = "trim"
            trimType = "left"
        },
        {
            field = "gf_external_product_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_product_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_product_desc"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_contract_alias_name"
            type = "trim"
            trimType = "both"
        },
        {
            field = "g_entity_contract_origin_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_contract_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_alias_name"
            type = "trim"
            trimType = "both"
        },
        {
            field = "card_unique_contract_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_card_renewal_expiry_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_car_account_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_card_administrator_type"
            type = "trim"
            trimType = "both"
        },
        {
            field = "aggr_card_brand_type"
            type = "trim"
            trimType = "both"
        },
        {
            field = "g_obfuscated_pan_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_cr_card_payment_expiry_date"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_billing_cycle_start_date"
            type = "trim"
            trimType = "both"
        },
        {
            field = "gf_billing_cycle_end_date"
            type = "trim"
            trimType = "both"
        },
        {
            field = "aggr_movement_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "aggr_transaction_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "movement_desc"
            type = "trim"
            trimType = "both"
        },
        {
            field = "aggr_move_amount"
            type = "trim"
            trimType = "both"
        },
        {
            field = "currency_id"
            type = "trim"
            trimType = "both"
        },
        {
            field = "transaction_type"
            type = "trim"
            trimType = "both"
        },
        {
            field = "origin_transaction_id"
            type = "trim"
            trimType = "both"
        },

        {
            default=${?INSTANCE_DATE}
            defaultType=string
            field="process_date"
            type=literal
        },
        {
            default=${?PERIOD_REP}
            defaultType=string
            field="process_date_period_id"
            type=literal
        },

        {
            field="operational_load_date"
            type=setCurrentDate
        },
        {
            field="operational_load_date"
            type=formatter
            typeToCast=string
            defaultType=string
        },
        {
            type = "conditional"
            field = "C"
            default="default"
            expressions=[
                {
                condition="B=='carlos'"
                field= "A"
                },
                
            ]
        },
         {
            field="operational_load_date"
            type=formatter
            typeToCast=string
            defaultType=string
    
        } 
    ]
}